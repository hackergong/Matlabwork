clear,clc
R  = [[0.2845,0.0045]',[0.0045,0.0455]'];
H  = [[1,0]',[0,1]',[0,0]',[0,0]'];
Q  = 0.01*eye(4);
P  = 100*eye(4);
dt = 1;
A  = [[1,0,0,0]',[0,1,0,0]',[dt,0,1,0]',[0,dt,0,1]'];
g = 1;
Bu = [0,0,0,g]';
x=zeros(20,4);
%e1=[29,29,29,28,28,28,28,29,28,30,28,27,30,31,30,30,28,34,31,33];
%e2=[25,26,27,29,30,30,32,33,35,38,39,41,45,46,50,51,52,58,60,60];
e1=[72,72,72,72,71,72,72,71,71,71,71,71,71,74,74,74,75,75,73,74];
e2=[26,27,28,30,31,32,33,35,36,38,40,42,44,44,47,51,52,55,56,56];
for i = 2 : 20
  xp=A*x(i-1,:)' + Bu;
  xpp(i,:)=(A*x(i-1,:)' + Bu)'
  PP = A*P*A' + Q;
  K = PP*H'*inv(H*PP*H'+R);
  x(i,:) = (xp + K*([e1(i),e2(i)]' - H*xp))'
  %x(i,:)
  [e1(i),e2(i)]
  P = (eye(4)-K*H)*PP ;
end

i=2:20
plot(i,x(i,:),'r',i,e1(i),'b',i,e2(i),'g')
figure
i=2:20
plot(i,x(i,:),'r',i,xpp(i,:),'g')


